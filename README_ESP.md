[–ù–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É](README.md)

# –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è ESP32

–ö–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ.

## –£—Ç–∏–ª–∏—Ç–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

–£—Ç–∏–ª–∏—Ç–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏, —Å–ª—É–∂–∏—Ç –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ –¥–∞—Ç—á–∏–∫–∞ MPU9250, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ù–∞ ESP32 —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–µ—Ä–≤–µ—Ä, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –Ω–µ–º—É –ø–æ Wi-Fi –∏ –∑–∞—Ö–æ–¥–∏–º —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä :

```cpp
#include <Wire.h>
#include <math.h>

// ====== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ü–ò–ù–û–í ======
#define MPU9250_SDA  21
#define MPU9250_SCL  22
#define LED_BUILTIN  2

// –ê–¥—Ä–µ—Å–∞ I2C
#define MPU9250_ADDRESS 0x68
#define AK8963_ADDRESS  0x0C

// –†–µ–≥–∏—Å—Ç—Ä—ã MPU9250
#define MPU9250_WHO_AM_I        0x75
#define MPU9250_PWR_MGMT_1      0x6B
#define MPU9250_ACCEL_XOUT_H    0x3B
#define MPU9250_GYRO_XOUT_H     0x43
#define MPU9250_ACCEL_CONFIG    0x1C
#define MPU9250_GYRO_CONFIG     0x1B
#define MPU9250_USER_CTRL       0x6A
#define MPU9250_INT_PIN_CFG     0x37

// –†–µ–≥–∏—Å—Ç—Ä—ã –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ AK8963
#define AK8963_WHO_AM_I         0x00
#define AK8963_ST1              0x02
#define AK8963_HXL              0x03
#define AK8963_CNTL1            0x0A
#define AK8963_ASAX             0x10

// ====== –ù–ê–°–¢–†–û–ô–ö–ò –ö–ê–õ–ò–ë–†–û–í–ö–ò ======
const int CALIBRATION_SAMPLES = 2000;      // 2000 –∏–∑–º–µ—Ä–µ–Ω–∏–π (~40 —Å–µ–∫—É–Ω–¥)
const unsigned long CALIBRATION_DELAY_MS = 20;

// ====== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ======
float mag_min[3] = {10000, 10000, 10000};
float mag_max[3] = {-10000, -10000, -10000};
float mag_data[2000][3];
int mag_data_count = 0;

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
enum CalibrationState {
    STATE_INIT,
    STATE_COLLECTING_DATA,
    STATE_ANALYZING,
    STATE_COMPLETE
};
CalibrationState currentState = STATE_INIT;

// ====== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° MPU9250 ======
bool writeByte(uint8_t address, uint8_t subAddress, uint8_t data) {
    Wire.beginTransmission(address);
    Wire.write(subAddress);
    Wire.write(data);
    return (Wire.endTransmission() == 0);
}

bool readBytes(uint8_t address, uint8_t subAddress, uint8_t count, uint8_t* dest) {
    Wire.beginTransmission(address);
    Wire.write(subAddress);
    if (Wire.endTransmission() != 0) return false;
    
    delayMicroseconds(100);
    
    uint8_t received = Wire.requestFrom(address, count);
    if (received != count) return false;
    
    for (uint8_t i = 0; i < count; i++) {
        dest[i] = Wire.read();
    }
    
    return true;
}

bool setupMagnetometer() {
    Serial.println("[MAG] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞...");
    
    if (!writeByte(MPU9250_ADDRESS, MPU9250_INT_PIN_CFG, 0x02)) {
        Serial.println("[MAG] –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å bypass —Ä–µ–∂–∏–º");
        return false;
    }
    delay(10);
    
    uint8_t whoami;
    if (!readBytes(AK8963_ADDRESS, AK8963_WHO_AM_I, 1, &whoami)) {
        Serial.println("[MAG] –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å WHO_AM_I");
        return false;
    }
    
    if (whoami != 0x48) {
        Serial.printf("[MAG] –û—à–∏–±–∫–∞: WHO_AM_I=0x%02X (–æ–∂–∏–¥–∞–ª–æ—Å—å 0x48)\n", whoami);
        return false;
    }
    
    if (!writeByte(AK8963_ADDRESS, AK8963_CNTL1, 0x00)) {
        Serial.println("[MAG] –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ —Ä–µ–∂–∏–º –ø–∏—Ç–∞–Ω–∏—è");
        return false;
    }
    delay(10);
    
    uint8_t asa_buf[3];
    if (!readBytes(AK8963_ADDRESS, AK8963_ASAX, 3, asa_buf)) {
        Serial.println("[MAG] –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã ASA");
        return false;
    }
    
    float asa_x = ((asa_buf[0] - 128) * 0.5f / 128.0f) + 1.0f;
    float asa_y = ((asa_buf[1] - 128) * 0.5f / 128.0f) + 1.0f;
    float asa_z = ((asa_buf[2] - 128) * 0.5f / 128.0f) + 1.0f;
    
    Serial.printf("[MAG] –ó–∞–≤–æ–¥—Å–∫–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ ASA: X=%.3f, Y=%.3f, Z=%.3f\n", asa_x, asa_y, asa_z);
    
    if (!writeByte(AK8963_ADDRESS, AK8963_CNTL1, 0x16)) {
        Serial.println("[MAG] –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä");
        return false;
    }
    
    delay(50);
    Serial.println("[MAG] –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ‚úì");
    return true;
}

bool readMagnetometer(int16_t* mx, int16_t* my, int16_t* mz) {
    uint8_t st1;
    if (!readBytes(AK8963_ADDRESS, AK8963_ST1, 1, &st1)) {
        return false;
    }
    
    if (!(st1 & 0x01)) {
        return false;
    }
    
    uint8_t buffer[7];
    if (!readBytes(AK8963_ADDRESS, AK8963_HXL, 7, buffer)) {
        return false;
    }
    
    if (buffer[6] & 0x08) {
        return false;
    }
    
    *mx = ((int16_t)buffer[1] << 8) | buffer[0];
    *my = ((int16_t)buffer[3] << 8) | buffer[2];
    *mz = ((int16_t)buffer[5] << 8) | buffer[4];
    
    return true;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
void printStatus(const char* status) {
    static unsigned long lastPrintTime = 0;
    unsigned long currentTime = millis();
    
    // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç—É—Å –Ω–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 500–º—Å
    if (currentTime - lastPrintTime > 500) {
        Serial.print("\r[–°–¢–ê–¢–£–°] ");
        Serial.print(status);
        Serial.print("                    "); // –û—á–∏—Å—Ç–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        lastPrintTime = currentTime;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
void advancedCalibration() {
    currentState = STATE_COLLECTING_DATA;
    
    Serial.println("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Serial.println("‚ïë    –£–¢–ò–õ–ò–¢–ê –ö–ê–õ–ò–ë–†–û–í–ö–ò –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê MPU9250   ‚ïë");
    Serial.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    
    Serial.println("\nüìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ö–ê–õ–ò–ë–†–û–í–ö–ï:");
    Serial.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    Serial.println("üéØ –¶–ï–õ–¨: –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ —Å–æ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω");
    Serial.println();
    Serial.println("üîÑ –ö–ê–ö –í–†–ê–©–ê–¢–¨ –£–°–¢–†–û–ô–°–¢–í–û:");
    Serial.println("   1. –ú–ï–î–õ–ï–ù–ù–û –≤—Ä–∞—â–∞–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 40 —Å–µ–∫—É–Ω–¥");
    Serial.println("   2. –í—Ä–∞—â–∞–π—Ç–µ –í–û –í–°–ï–• –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö:");
    Serial.println("      ‚Ä¢ –ü–æ –∫—Ä—É–≥—É (–∫–∞–∫ –∫–æ–º–ø–∞—Å)");
    Serial.println("      ‚Ä¢ –ù–∞–∫–ª–æ–Ω—ã –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥");
    Serial.println("      ‚Ä¢ –ù–∞–∫–ª–æ–Ω—ã –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ");
    Serial.println("      ‚Ä¢ –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ");
    Serial.println("   3. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –æ—Ö–≤–∞—Ç–∏—Ç—å –≤—Å–µ —Å—Ç–æ—Ä–æ–Ω—ã");
    Serial.println("   4. –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–µ–∑–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π");
    Serial.println();
    Serial.println("‚ö†Ô∏è  –í–ê–ñ–ù–´–ï –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:");
    Serial.println("   ‚Ä¢ –î–µ—Ä–∂–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –º–µ—Ç–∞–ª–ª–∞");
    Serial.println("   ‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–∏–ª—å–Ω—ã—Ö –º–∞–≥–Ω–∏—Ç–æ–≤ —Ä—è–¥–æ–º");
    Serial.println("   ‚Ä¢ –õ—É—á—à–µ –∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–º —Å—Ç–æ–ª–µ");
    Serial.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
    mag_data_count = 0;
    for (int i = 0; i < 3; i++) {
        mag_min[i] = 10000;
        mag_max[i] = -10000;
    }
    
    // –ò–Ω–¥–∏–∫–∞—Ü–∏—è –Ω–∞—á–∞–ª–∞
    Serial.println("üöÄ –ù–ê–ß–ò–ù–ê–ï–ú –ö–ê–õ–ò–ë–†–û–í–ö–£...");
    Serial.println("   –°–≤–µ—Ç–æ–¥–∏–æ–¥ –±—É–¥–µ—Ç –≥–æ—Ä–µ—Ç—å –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö\n");
    
    for (int i = 0; i < 3; i++) {
        digitalWrite(LED_BUILTIN, HIGH);
        delay(200);
        digitalWrite(LED_BUILTIN, LOW);
        delay(200);
    }
    digitalWrite(LED_BUILTIN, HIGH);
    
    Serial.println("‚è≥ –°–ë–û–† –î–ê–ù–ù–´–• (0%):");
    Serial.print("[‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]");
    
    unsigned long startTime = millis();
    int valid_samples = 0;
    
    // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
    for (int i = 0; i < CALIBRATION_SAMPLES; i++) {
        int16_t mx, my, mz;
        if (readMagnetometer(&mx, &my, &mz)) {
            if (mag_data_count < CALIBRATION_SAMPLES) {
                mag_data[mag_data_count][0] = mx;
                mag_data[mag_data_count][1] = my;
                mag_data[mag_data_count][2] = mz;
                mag_data_count++;
                valid_samples++;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º min/max
                if (mx < mag_min[0]) mag_min[0] = mx;
                if (mx > mag_max[0]) mag_max[0] = mx;
                if (my < mag_min[1]) mag_min[1] = my;
                if (my > mag_max[1]) mag_max[1] = my;
                if (mz < mag_min[2]) mag_min[2] = mz;
                if (mz > mag_max[2]) mag_max[2] = mz;
            }
        }
        
        delay(CALIBRATION_DELAY_MS);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –∫–∞–∂–¥—ã–µ 2%
        if (i % (CALIBRATION_SAMPLES / 50) == 0) {
            int progress = (i * 50) / CALIBRATION_SAMPLES;
            Serial.print("\r[");
            for (int p = 0; p < 50; p++) {
                if (p < progress) {
                    Serial.print("‚ñà");
                } else {
                    Serial.print("‚ñë");
                }
            }
            Serial.print("] ");
            Serial.print(progress * 2);
            Serial.print("%");
            
            // –í—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
            char statusMsg[50];
            snprintf(statusMsg, sizeof(statusMsg), "–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö: %d/%d", i, CALIBRATION_SAMPLES);
            printStatus(statusMsg);
        }
    }
    
    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
    Serial.print("\r[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%\n\n");
    
    digitalWrite(LED_BUILTIN, LOW);
    
    float calibration_time = (millis() - startTime) / 1000.0f;
    Serial.printf("‚úÖ –°–ë–û–† –î–ê–ù–ù–´–• –ó–ê–í–ï–†–®–ï–ù!\n");
    Serial.printf("   –í—Ä–µ–º—è: %.1f —Å–µ–∫—É–Ω–¥\n", calibration_time);
    Serial.printf("   –£—Å–ø–µ—à–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π: %d/%d\n", valid_samples, CALIBRATION_SAMPLES);
    
    if (mag_data_count < 500) {
        Serial.println("\n‚ùå –û–®–ò–ë–ö–ê: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏!");
        Serial.println("   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:");
        Serial.println("   1. –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ");
        Serial.println("   2. –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
        Serial.println("   3. –ü–æ–º–µ—Ö–∏ –æ—Ç –º–µ—Ç–∞–ª–ª–∞");
        Serial.println("\n   –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑, –≤—Ä–∞—â–∞–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ú–ï–î–õ–ï–ù–ù–ï–ï.");
        return;
    }
    
    currentState = STATE_ANALYZING;
    Serial.println("\nüîç –ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•...");
    printStatus("–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏");
    
    // –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
    float ranges[3];
    for (int i = 0; i < 3; i++) {
        ranges[i] = mag_max[i] - mag_min[i];
    }
    
    Serial.printf("\nüìä –î–ò–ê–ü–ê–ó–û–ù –î–ê–ù–ù–´–•:\n");
    Serial.printf("   X: %.0f (min=%.0f, max=%.0f)\n", ranges[0], mag_min[0], mag_max[0]);
    Serial.printf("   Y: %.0f (min=%.0f, max=%.0f)\n", ranges[1], mag_min[1], mag_max[1]);
    Serial.printf("   Z: %.0f (min=%.0f, max=%.0f)\n", ranges[2], mag_min[2], mag_max[2]);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
    float avg_range = (ranges[0] + ranges[1] + ranges[2]) / 3.0f;
    Serial.printf("\nüìà –°–†–ï–î–ù–ò–ô –î–ò–ê–ü–ê–ó–û–ù: %.0f\n", avg_range);
    
    if (avg_range < 200) {
        Serial.println("‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –î–∏–∞–ø–∞–∑–æ–Ω —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π!");
        Serial.println("   –í–µ—Ä–æ—è—Ç–Ω–æ, –≤—ã –≤—Ä–∞—â–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ.");
    } else if (avg_range < 300) {
        Serial.println("‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –î–∏–∞–ø–∞–∑–æ–Ω –º–∞–ª–æ–≤–∞—Ç");
        Serial.println("   –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –≤—Ä–∞—â–∞–π—Ç–µ –∞–∫—Ç–∏–≤–Ω–µ–µ.");
    } else if (avg_range > 800) {
        Serial.println("‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –î–∏–∞–ø–∞–∑–æ–Ω —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π!");
        Serial.println("   –í–æ–∑–º–æ–∂–Ω–æ, —Ä—è–¥–æ–º –µ—Å—Ç—å –º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–º–µ—Ö–∏.");
    } else {
        Serial.println("‚úì –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–æ—Ä–º–µ");
    }
    
    // –ú–µ—Ç–æ–¥ 1: –ü—Ä–æ—Å—Ç–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
    Serial.println("\n‚öôÔ∏è  –í–´–ß–ò–°–õ–ï–ù–ò–ï –ü–ê–†–ê–ú–ï–¢–†–û–í –ö–ê–õ–ò–ë–†–û–í–ö–ò...");
    printStatus("–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏");
    
    float bias_simple[3], scale_simple[3];
    
    for (int i = 0; i < 3; i++) {
        bias_simple[i] = (mag_min[i] + mag_max[i]) / 2.0f;
        scale_simple[i] = 1.0f / (ranges[i] / 2.0f);
    }
    
    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—à—Ç–∞–±–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
    float avg_scale = (scale_simple[0] + scale_simple[1] + scale_simple[2]) / 3.0f;
    for (int i = 0; i < 3; i++) {
        scale_simple[i] = scale_simple[i] / avg_scale;
    }
    
    // –ú–µ—Ç–æ–¥ 2: –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    Serial.println("‚öôÔ∏è  –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–ê–†–ê–ú–ï–¢–†–û–í...");
    float bias_opt[3] = {bias_simple[0], bias_simple[1], bias_simple[2]};
    float scale_opt[3] = {scale_simple[0], scale_simple[1], scale_simple[2]};
    
    for (int iter = 0; iter < 10; iter++) {
        float sum_radius = 0;
        int count = 0;
        
        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–¥–∏—É—Å
        for (int i = 0; i < mag_data_count; i += 10) {
            float x_cal = (mag_data[i][0] - bias_opt[0]) * scale_opt[0];
            float y_cal = (mag_data[i][1] - bias_opt[1]) * scale_opt[1];
            float z_cal = (mag_data[i][2] - bias_opt[2]) * scale_opt[2];
            
            float radius = sqrt(x_cal*x_cal + y_cal*y_cal + z_cal*z_cal);
            sum_radius += radius;
            count++;
        }
        
        if (count > 0) {
            float target_radius = sum_radius / count;
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –º–∞—Å—à—Ç–∞–± –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫ —Ü–µ–ª–µ–≤–æ–º—É —Ä–∞–¥–∏—É—Å—É
            for (int i = 0; i < 3; i++) {
                scale_opt[i] *= (target_radius / 100.0f);
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
    Serial.println("\nüî¨ –ü–†–û–í–ï–†–ö–ê –¢–û–ß–ù–û–°–¢–ò –ö–ê–õ–ò–ë–†–û–í–ö–ò...");
    printStatus("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏");
    
    float radius_min = 10000, radius_max = -10000;
    float radius_sum = 0;
    int test_samples = min(mag_data_count, 200);
    
    for (int i = 0; i < test_samples; i++) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        float x_cal = (mag_data[i][0] - bias_opt[0]) * scale_opt[0];
        float y_cal = (mag_data[i][1] - bias_opt[1]) * scale_opt[1];
        float z_cal = (mag_data[i][2] - bias_opt[2]) * scale_opt[2];
        
        float radius = sqrt(x_cal*x_cal + y_cal*y_cal + z_cal*z_cal);
        radius_sum += radius;
        
        if (radius < radius_min) radius_min = radius;
        if (radius > radius_max) radius_max = radius;
    }
    
    float radius_avg = radius_sum / test_samples;
    float radius_variation = (radius_max - radius_min) / radius_avg * 100;
    
    Serial.printf("üìê –†–ê–î–ò–£–° –ü–û–°–õ–ï –ö–ê–õ–ò–ë–†–û–í–ö–ò:\n");
    Serial.printf("   –°—Ä–µ–¥–Ω–∏–π: %.1f\n", radius_avg);
    Serial.printf("   –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π: %.1f\n", radius_min);
    Serial.printf("   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π: %.1f\n", radius_max);
    Serial.printf("   –ò–∑–º–µ–Ω–µ–Ω–∏–µ: %.1f%%\n", radius_variation);
    
    Serial.println("\nüéØ –û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê –ö–ê–õ–ò–ë–†–û–í–ö–ò:");
    
    if (radius_variation < 10) {
        Serial.println("   üèÜ –û–¢–õ–ò–ß–ù–û! –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ");
    } else if (radius_variation < 15) {
        Serial.println("   üëç –û–ß–ï–ù–¨ –•–û–†–û–®–û! –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –æ—Ç–ª–∏—á–Ω–æ–µ");
    } else if (radius_variation < 20) {
        Serial.println("   ‚úÖ –•–û–†–û–®–û! –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ —Ö–æ—Ä–æ—à–µ–µ");
    } else if (radius_variation < 25) {
        Serial.println("   ‚ö†Ô∏è  –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û! –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ —Å—Ä–µ–¥–Ω–µ–µ");
    } else if (radius_variation < 30) {
        Serial.println("   ‚ö†Ô∏è  –ü–†–ò–ï–ú–õ–ï–ú–û! –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ");
        Serial.println("   –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–æ —Ç–æ—á–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∏–¥–µ–∞–ª—å–Ω–æ–π");
    } else {
        Serial.println("   ‚ùå –ù–ò–ó–ö–û–ï –ö–ê–ß–ï–°–¢–í–û! –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å");
        Serial.println("   –í—Ä–∞—â–∞–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ");
    }
    
    currentState = STATE_COMPLETE;
    printStatus("–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
    
    // –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É
    Serial.println("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Serial.println("‚ïë        –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ö–ê–õ–ò–ë–†–û–í–ö–ò               ‚ïë");
    Serial.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    
    Serial.println("\nüìã –°–ö–û–ü–ò–†–£–ô–¢–ï –≠–¢–ò –î–ê–ù–ù–´–ï –í –û–°–ù–û–í–ù–£–Æ –ü–†–û–ì–†–ê–ú–ú–£:");
    Serial.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    Serial.println("üìç –í –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:");
    Serial.println("   '–†–£–ß–ù–´–ï –ö–ê–õ–ò–ë–†–û–í–û–ß–ù–´–ï –î–ê–ù–ù–´–ï –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê'");
    Serial.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    Serial.println();
    Serial.println("// ====== –†–£–ß–ù–´–ï –ö–ê–õ–ò–ë–†–û–í–û–ß–ù–´–ï –î–ê–ù–ù–´–ï –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê =====");
    Serial.printf("const float MAG_BIAS_X = %.1ff;     // –°–º–µ—â–µ–Ω–∏–µ –ø–æ X\n", bias_opt[0]);
    Serial.printf("const float MAG_BIAS_Y = %.1ff;     // –°–º–µ—â–µ–Ω–∏–µ –ø–æ Y\n", bias_opt[1]);
    Serial.printf("const float MAG_BIAS_Z = %.1ff;     // –°–º–µ—â–µ–Ω–∏–µ –ø–æ Z\n", bias_opt[2]);
    Serial.printf("const float MAG_SCALE_X = %.5ff;    // –ú–∞—Å—à—Ç–∞–± –ø–æ X\n", scale_opt[0]);
    Serial.printf("const float MAG_SCALE_Y = %.5ff;    // –ú–∞—Å—à—Ç–∞–± –ø–æ Y\n", scale_opt[1]);
    Serial.printf("const float MAG_SCALE_Z = %.5ff;    // –ú–∞—Å—à—Ç–∞–± –ø–æ Z\n", scale_opt[2]);
    Serial.println();
    Serial.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    Serial.println("üìù –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê:");
    Serial.printf("   ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω: %.0f\n", avg_range);
    Serial.printf("   ‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏: %.1f%%\n", 100 - min(radius_variation, 100.0f));
    Serial.printf("   ‚Ä¢ –í—Ä–µ–º—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏: %.1f —Å–µ–∫\n", calibration_time);
    Serial.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    Serial.println("üí° –°–û–í–ï–¢–´ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ô –ö–ê–õ–ò–ë–†–û–í–ö–ò:");
    if (radius_variation > 20) {
        Serial.println("   1. –í—Ä–∞—â–∞–π—Ç–µ –µ—â–µ –ú–ï–î–õ–ï–ù–ù–ï–ï");
        Serial.println("   2. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Ö–≤–∞—Ç–∏—Ç—å –í–°–ï –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ");
        Serial.println("   3. –ò–∑–±–µ–≥–∞–π—Ç–µ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π");
    } else {
        Serial.println("   –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.");
    }
    
    Serial.println("\n‚úÖ –ö–ê–õ–ò–ë–†–û–í–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!");
    Serial.println("   –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.");
    Serial.println("   –î–ª—è –≤—ã—Ö–æ–¥–∞ –∑–∞–∫—Ä–æ–π—Ç–µ Serial Monitor.");
    
    // –ò–Ω–¥–∏–∫–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    for (int i = 0; i < 5; i++) {
        digitalWrite(LED_BUILTIN, HIGH);
        delay(100);
        digitalWrite(LED_BUILTIN, LOW);
        delay(100);
    }
    
    // –ú–∏–≥–∞–Ω–∏–µ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    while (true) {
        digitalWrite(LED_BUILTIN, HIGH);
        delay(500);
        digitalWrite(LED_BUILTIN, LOW);
        delay(500);
    }
}

// ====== SETUP ======
void setup() {
    Serial.begin(115200);
    delay(1000);
    
    Serial.println("\n\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Serial.println("‚ïë    –£–¢–ò–õ–ò–¢–ê –ö–ê–õ–ò–ë–†–û–í–ö–ò –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê MPU9250   ‚ïë");
    Serial.println("‚ïë             –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ v1.0                  ‚ïë");
    Serial.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    
    Serial.println("\nüîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø...");
    printStatus("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã");
    
    pinMode(LED_BUILTIN, OUTPUT);
    digitalWrite(LED_BUILTIN, LOW);
    
    Serial.println("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∏–Ω–æ–≤... ‚úì");
    
    Wire.begin(MPU9250_SDA, MPU9250_SCL);
    Wire.setClock(400000);
    
    Serial.println("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ I2C... ‚úì");
    
    Serial.println("\nüîç –ü–†–û–í–ï–†–ö–ê –î–ê–¢–ß–ò–ö–ê MPU9250...");
    printStatus("–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—á–∏–∫–∞ MPU9250");
    
    if (!writeByte(MPU9250_ADDRESS, MPU9250_PWR_MGMT_1, 0x80)) {
        Serial.println("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–±—Ä–æ—Å–∏—Ç—å MPU9250");
        while(1) {
            digitalWrite(LED_BUILTIN, HIGH);
            delay(100);
            digitalWrite(LED_BUILTIN, LOW);
            delay(100);
        }
    }
    delay(100);
    
    if (!writeByte(MPU9250_ADDRESS, MPU9250_PWR_MGMT_1, 0x01)) {
        Serial.println("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å MPU9250");
        while(1);
    }
    
    delay(100);
    
    uint8_t whoami;
    if (!readBytes(MPU9250_ADDRESS, MPU9250_WHO_AM_I, 1, &whoami)) {
        Serial.println("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å WHO_AM_I");
        while(1);
    }
    
    Serial.printf("   ‚Ä¢ MPU9250 ID: 0x%02X\n", whoami);
    
    if (whoami != 0x71 && whoami != 0x73) {
        Serial.println("‚ùå –û–®–ò–ë–ö–ê: –ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–∞—Ç—á–∏–∫–∞!");
        Serial.println("   –û–∂–∏–¥–∞–ª–æ—Å—å: 0x71 –∏–ª–∏ 0x73");
        while(1);
    }
    
    Serial.println("   ‚Ä¢ MPU9250 –æ–±–Ω–∞—Ä—É–∂–µ–Ω ‚úì");
    
    Serial.println("\nüîß –ù–ê–°–¢–†–û–ô–ö–ê –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê...");
    printStatus("–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞");
    
    if (!setupMagnetometer()) {
        Serial.println("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä!");
        Serial.println("\nüîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´:");
        Serial.println("   1. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º I2C");
        Serial.println("   2. –ù–µ–∏—Å–ø—Ä–∞–≤–Ω—ã–π –¥–∞—Ç—á–∏–∫");
        Serial.println("   3. –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∏–Ω—ã SDA/SCL");
        while(1) {
            digitalWrite(LED_BUILTIN, HIGH);
            delay(500);
            digitalWrite(LED_BUILTIN, LOW);
            delay(500);
        }
    }
    
    Serial.println("\n‚úÖ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ö–ê–õ–ò–ë–†–û–í–ö–ï!");
    Serial.println("   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...");
    Serial.println("   –î–ª—è –æ—Ç–º–µ–Ω—ã –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ");
    
    // –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç
    for (int i = 3; i > 0; i--) {
        Serial.printf("\r   –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑: %d —Å–µ–∫—É–Ω–¥...", i);
        delay(1000);
    }
    
    Serial.println("\n\nüöÄ –ó–ê–ü–£–°–ö –ö–ê–õ–ò–ë–†–û–í–ö–ò...");
    delay(500);
    
    // –ó–∞–ø—É—Å–∫ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
    advancedCalibration();
}

// ====== LOOP ======
void loop() {
    // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è
    // advancedCalibration() –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å –º–∏–≥–∞–Ω–∏–µ–º LED
    delay(1000);
}
```

## üéØ **–û–°–ù–û–í–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:**

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫**
- –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
- –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω—ã (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)

### 2. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**
- –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤—Ä–∞—â–µ–Ω–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (—ç–º–æ–¥–∑–∏ –∏ —Ä–∞–º–∫–∏)
- –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### 3. **–í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å**
- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (–æ—Ç 0% –¥–æ 100%)
- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ò–Ω–¥–∏–∫–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

### 4. **–°—Ç–∞—Ç—É—Å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞**
- –§—É–Ω–∫—Ü–∏—è `printStatus()` –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 500–º—Å
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
- –û—Ü–µ–Ω–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ (–æ—Ç "–û—Ç–ª–∏—á–Ω–æ" –¥–æ "–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ")
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 6. **–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–æ–≤–µ—Ç—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

### 7. **–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è**
- LED –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
  - –ú–∏–≥–∞–Ω–∏–µ: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –≥–æ—Ä–∏—Ç: —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
  - –ë—ã—Å—Ç—Ä–æ –º–∏–≥–∞–µ—Ç: –∞–Ω–∞–ª–∏–∑
  - –ú–µ–¥–ª–µ–Ω–Ω–æ –º–∏–≥–∞–µ—Ç: –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

## üìã **–ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:**

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥** –Ω–∞ ESP32
2. **–û—Ç–∫—Ä–æ–π—Ç–µ Serial Monitor** (115200 –±–æ–¥)
3. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏** –Ω–∞ —ç–∫—Ä–∞–Ω–µ
4. **–í—Ä–∞—â–∞–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ** –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
6. **–í—Å—Ç–∞–≤—å—Ç–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É**

## üö® **–ß–¢–û –î–ï–õ–ê–¢–¨ –ï–°–õ–ò –ö–ê–õ–ò–ë–†–û–í–ö–ê –ù–ï –£–î–ê–õ–ê–°–¨:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –º–µ—Ç–∞–ª–ª–∞ —Ä—è–¥–æ–º
3. –í—Ä–∞—â–∞–π—Ç–µ –ú–ï–î–õ–ï–ù–ù–ï–ï –∏ –†–ê–í–ù–û–ú–ï–†–ù–ï–ï
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

## üìä **–û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê:**

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:
- **< 10%** - –û—Ç–ª–∏—á–Ω–æ üèÜ
- **10-15%** - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ üëç
- **15-20%** - –•–æ—Ä–æ—à–æ ‚úÖ
- **20-25%** - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ ‚ö†Ô∏è
- **25-30%** - –ü—Ä–∏–µ–º–ª–µ–º–æ ‚ö†Ô∏è
- **> 30%** - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ ‚ùå

**–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!**

---

[–í –Ω–∞—á–∞–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞](#–∫–æ–¥-–ø—Ä–æ–µ–∫—Ç–∞-–¥–ª—è-esp32)

[–ù–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É](README.md)
